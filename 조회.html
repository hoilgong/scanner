<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport"
  content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>ìƒí’ˆ ì¡´ ì¡°íšŒ</title>

<script src="https://cdnjs.cloudflare.com/ajax/libs/quagga/0.12.1/quagga.min.js"></script>

<style>
  html, body{
    height:100%;
    margin:0;
    padding:0;
    overflow:hidden;
  }
  body{
    font-family:Arial;
    padding:20px;
    touch-action:none;
  }

  #scanner{
    width:100%;
    max-width:380px;
    height:240px;
    margin:auto;
    border:2px solid #888;
    border-radius:8px;
    overflow:hidden;
    position:relative;
  }
  #scanner video{
    object-fit:cover;
    width:100%;
    height:100%;
  }

  .scan-line{
    position:absolute;
    top:50%;
    left:0;
    width:100%;
    height:2px;
    background:red;
    opacity:0.85;
    transform:translateY(-50%);
  }

  #zone{
    margin-top:20px;
    font-size:22px;
    font-weight:bold;
  }

  #restartBtn{
    margin-top:20px;
    padding:10px 15px;
    font-size:18px;
  }

  @media(max-width:600px){
    #scanner{
      height:200px;
      max-width:330px;
    }
  }
</style>

</head>
<body>

<h2>ìƒí’ˆ ì¡´ ì¡°íšŒ</h2>

<div id="scanner">
  <div class="scan-line"></div>
</div>

<div id="zone">ìŠ¤ìº” í›„ ì¡´ì´ í‘œì‹œë©ë‹ˆë‹¤</div>

<button id="restartBtn">ë‹¤ìŒ ìŠ¤ìº”</button>

<script>
let skuMap = {};

fetch("https://script.google.com/macros/s/AKfycbxZ8_Sg90rJC8IczpXmK0NTRDuI1QV6B5_h1AYN_gpnV750ZuDBZHker78bBZJoe1mj/exec")
.then(r=>r.json())
.then(d=>skuMap = d);

function startScanner(){
  Quagga.init({
    inputStream:{
      type:"LiveStream",
      target:document.querySelector('#scanner'),
      constraints:{
        facingMode:"environment",
        advanced:[{zoom:1.0}]
      }
    },
    decoder:{
      // ğŸ”¥ EAN ì „ìš© (ë„¤ê°€ ì›í•˜ëŠ” ë°”ì½”ë“œ í˜•ì‹ë§Œ)
      readers:[
        "ean_13_reader",
        "ean_reader",
        "ean_8_reader"
      ]
    },
    locate:true,
    patchSize:"medium",
    debug:false
  }, err=>{
    if(err){console.log(err);return;}
    Quagga.start();
  });
}

startScanner();

// =========================
// 1ë²ˆ ì½ìœ¼ë©´ STOP
// =========================
Quagga.onDetected(res=>{
  const code = res.codeResult.code;

  Quagga.stop();

  const zone = skuMap[code] || "ë¯¸ë“±ë¡ ì½”ë“œ";
  document.getElementById("zone").innerText =
    `ë°”ì½”ë“œ: ${code} / ì¡´: ${zone}`;

  if(navigator.vibrate){
    navigator.vibrate(200);
  }
});

// =========================
// ë‹¤ìŒ ìŠ¤ìº”
// =========================
document.getElementById("restartBtn").addEventListener("click", ()=>{
  document.getElementById("zone").innerText = "ìŠ¤ìº” í›„ ì¡´ì´ í‘œì‹œë©ë‹ˆë‹¤";
  startScanner();
});

</script>

</body>
</html>
